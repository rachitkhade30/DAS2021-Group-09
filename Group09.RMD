---
title: "Analysing IMDB film dataset to predict IMDB ratings"
author: "Jialin Sun, yiming lei, Yilin Liang, Ruilin Ma, Rachit Rakesh Khade"
date: "2021/7/23"
output:
  pdf_document:
    latex_engine: pdflatex
    number_sections: yes
  html_document:
    df_print: paged
  word_document: default
fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = TRUE, warning = FALSE, message = FALSE, comment = NA)
```

```{r libraries,echo = FALSE}
library(tidyverse)
library(moderndive)
library(skimr)
library(kableExtra)
library(gridExtra)
library(devtools)
library(magrittr)
library(ggplot2)
library(maps)
library(RColorBrewer)
library(viridis)
library(ggpubr)
library(GGally)
library(corrplot)
library(knitr)
library(olsrr)
library(data.table)
library(moderndive)
library(ggfortify)
library(diagram)
library(ggthemes)
library(showtext)
library(ggnewscale)
library(gapminder)
library(janitor)
library(sjPlot)
library(stats)
library(jtools)
library(Rcpp)
library(cowplot)
library(ROCR)
```

```{R data, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
#read the file
dat<-read.csv("dataset9.csv")
#add the  column,if rating>7,then 1,else 0
dat<-mutate(dat,score=ifelse(rating>7,1,0))
#replace NA with mean value in length column 
dat$length[is.na(dat$length)]<-mean(dat$length,na.rm = TRUE)
dat$scorename[dat$score==1] <- "greater than 7"
dat$scorename[dat$score==0] <- "lower than 7"
```

# Introduction {#sec:Intro}

With the gradual improvement of materialistic lifestyles, the pursuit of human life is not only limited to having good food and clothing, but also begins to have spiritual goals. Jackson T and Marks N. believe that people’s life has shifted from material pursuit to spiritual pursuit in the past 40 years according to their consumption outlook (Jackson T, Marks N.1999). In recent years, watching movies has become an indispensable form of entertainment(Kubrak T.2020). According to sociological analysis, a film is not only a good medium to spread cultural and social values, but also a kind of relaxed entertainment (Balabantaray S R.2014). In most movies, the social phenomena expressed are deeply engraved in the minds of audiences by bringing people emotions such as touching, happiness, sadness and memories (Homan R L.1997).

In order to make a better a successful movie, this analysis will explore the influencing factors of movie ratings by analysing 3001 movies from the IMDB movie database. IMDb, originally a hobby organization of international fan groups, is currently a website owned by Amazon and contains as much information as possible about every movie (Peralta v. 2007). According to the description of films in the database, it can beseen that they are related to six main factors, which are year, running time, budget, number of positive votes, genre of film, and IMDB rating. Throughout the analysis, we’ll be looking at different charts and then establish a generalized linear model to analyse the relationship between IMDB rating and several important factors affecting the rating. The rating score of 7 is critical boundary to judge the film quality. The knowledge of significant influencing factors can be applied to the field of film production.

This paper mainly consists of six parts. The Section \ref{sec:Intro} is introduction. The Section \ref{sec:MET} is the main definition and method of the factors used in the analysis. The Section \ref{sec:EDA} is the exploratory data analysis of IMDB rating and these factors, and studies the relationship between them. In Section \ref{sec:FDA}, the generalized linear model (GLM) is used to analyze the data. The Section \ref{sec:Conc} is the summary of the analysis. The Section \ref{sec:REF} is the reference.

# Main Definitions And Method {#sec:MET}

## Population and Data {#sec:PAD}

### Population {#sec:POP}

3001 movies from the IMDB movie database

### Data Collection {#sec:DCO}

The data comes from the IMDB movie database.
The variables are shown in the followed table.

```{r data1, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE,out.width = 2}
#Please make a new table1
#table2

```


```{r data3436, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE,out.heighth='110%',out.width='110%'}
#remane the variables
text_tbl <- data.frame(
  Variable=c("film.id","year","length","budget","votes","genre","rating"),
  Type=c("Identification variable","Continuous independent variable","Continuous independent variable","Continuous independent variable","Continuous independent variable","Independent Categorical Variable","Response variable"),
  Description=c("Unique identifier for the film","Year in which the film was released in cinemas","The run-time of the film(in minutes)","Budget required for the film production(in millions)","Number of positive votes received by the viewers","Genre of the film","IMDB Rating from 0-10(10 being the highest)")
  )
#summarise the variable and produce the table
kable(text_tbl,caption = '\\label{tab:summaries1} Variable description',  align = c("c", "c", "c")) %>%
  kable_styling(full_width = F,latex_options = "hold_position", font_size = 8) %>%
  column_spec(1, bold = T, border_right = T) %>%
  column_spec(2, width = "6em")%>%
  column_spec(3, width = "10em")
```

```{r data3434, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE,out.heighth='110%',out.width='110%'}

text_tbl <- data.frame(
Different_Genre = c("Action","Animation","Comedy","Documentary","Drama","Romance","Short")
)

kable(text_tbl,caption = '\\label{tab:summaries2} Genre',  align = c("c", "c", "c")) %>%
  kable_styling(full_width = F,latex_options = "hold_position") %>%
  column_spec(1, bold = T)
  
```
## Objective {#sec:OBJ}

### Primary Objective {#sec:PRO}

Analyze the properties of films that influence whether they'll be rated greater than 7 or not.

### Secondary Objectives {#sec:SEO}

Analyze the most significant features which influence the IMDB ratings of a film.
Analyze the relationship between the six properties of films namely, year, running time, budget, number of positive votes, genre and IMDB rating.

## Work-flow {#sec:FLOW}

```{r data2, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE,out.heighth='80%',out.width='80%'}
#produce flow chart
pos <- coordinates(pos = c(5,5))
cc <- c("Introduction", "Definition\nAnd\nMethod","Exploratory\nData Analysis",
        "Formal Data\nAnalysis", "Conclusion \nand \nFuture Work","NULL", "NULL"," Pie chat,\nHistogram,\nBoxplot",
        "Correlation\nmatrix,\n(GLM) model"," NULL")
openplotmat(main = "Flow Chart")
straightarrow(from = pos[1,] ,to = pos[2,],lwd = 2, arr.pos = 0.6)
straightarrow(from = pos[2,] ,to = pos[3,],lwd = 2, arr.pos = 0.6)
straightarrow(from = pos[3,] ,to = pos[4,],lwd = 2, arr.pos = 0.6)
straightarrow(from = pos[4,] ,to = pos[5,],lwd = 2, arr.pos = 0.6)
straightarrow(from = pos[4,] ,to = pos[5,],lwd = 2, arr.pos = 0.6)
straightarrow(from = pos[3,] ,to = pos[8,],lwd = 2, arr.pos = 0.8)
straightarrow(from = pos[4,] ,to = pos[9,],lwd = 2, arr.pos = 0.8)
for(i in c(1, 2, 3, 4, 5)) textrect(pos[i,],radx = 0.08,rady = 0.1,shadow.size=0,lab = cc[i],cex=0.8)
for(i in c(8, 9)) textrect(pos[i,],radx = 0.08,rady = 0.1,shadow.size=0,lab = cc[i],cex=0.8)
```

# Exploratory Data Analysis {#sec:EDA}
## Basic Feature Analysis of Films {#sec:Bas}
First we'll just take a look at the dataset. First few rows of the dataset are shown below.
```{r head,echo=FALSE}
#The table of visualization of part of the data
dat.1<-dat %>%
  select(year,length,budget,votes,genre,rating) #exclude the useless variable film.id
head(dat.1) -> table # put the part of visual data into table
# Set table parameters
table%>%
  kable(caption = '\\label{tab:head} Visualization of part of the data',  align = c("c", "c", "c")) %>%
kable_styling(latex_options = "hold_position")
```

Then we summarize this dataset.
```{r table, echo = FALSE}
#The table of year
dat %>%
summarise(name="Year", n=n(),Mean=round(mean(year),digits=1), St.Dev=round(sd(year),digits=1),
Min=min(year), Q1 = quantile(year,0.25), Median=median(year),
Q3 = quantile(year,0.75), Max=max(year))-> table1 # put Descriptive statistics of variable year into table1

#The table of length
dat %>%
summarise(name="Length", n=n(),Mean=round(mean(length),digits=1), St.Dev=round(sd(length),digits=1),
Min=min(length), Q1 = quantile(length,0.25), Median=median(length),
Q3 = quantile(length,0.75), Max=max(length))-> table2 # put Descriptive statistics of variable length into table1

#The table of budget
dat %>%
summarise(name="Budget", n=n(),Mean=round(mean(budget),digits=1), St.Dev=round(sd(budget),digits=1),
Min=min(budget), Q1 = quantile(budget,0.25), Median=median(budget),
Q3 = quantile(budget,0.75), Max=max(budget))-> table3 # put Descriptive statistics of variable budget into table1

#The table of votes
dat %>%
summarise(name="Votes", n=n(),Mean=round(mean(votes),digits=1), St.Dev=round(sd(votes),digits=1),
Min=min(votes), Q1 = quantile(votes,0.25), Median=median(votes),
Q3 = quantile(votes,0.75), Max=max(votes))-> table4 # put Descriptive statistics of variable votes into table1

#The table of rating
dat %>%
summarise(name="Rating", n=n(),Mean=round(mean(rating),digits=1), St.Dev=round(sd(rating),digits=1),
Min=min(rating), Q1 = quantile(rating,0.25), Median=median(rating),
Q3 = quantile(rating,0.75), Max=max(rating))-> table5 # put Descriptive statistics of variable rating into table1

#Combining the two tables
dplyr::union_all(table1,table2) -> table
dplyr::union_all(table,table3) -> table
dplyr::union_all(table,table4) -> table
dplyr::union_all(table,table5) -> table

# Set table parameters
table%>%
  kable(caption = '\\label{tab:summaries} Summary statistics',  align = c("c", "c", "c")) %>%
kable_styling(latex_options = "hold_position")
```

Firstly, in order to explore the data, the summary of different variables is necessary. The above table is the summary table of five numeric variables along with their descriptive statistic. The general analysis of the sample data shows that the total sample size is 3001. The oldest film in the sample was released in the year 1895, and the latest was released in 2005. The average length of the films is 81.6 minutes, with the shortest being just one minute and the longest bring 555 minutes. Budgets ranges from 1.2 million dollars to 23.4 million dollars, and according to the quartile, most films still cost more than 10 million dollars. It can be seen from the standard deviation of votes that there is a large difference between different films, with the standard deviation reaching 3780.1, while the average value is only 655.8. In terms of film rating data, most films are rated around 5 out of 10, and the best film being rated as 9.2 while the lowest is only rated 0.8.

```{r histogram1, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:histogramyear} Year histogram",out.heighth='75%',out.width='75%',fig.pos = 'H'}
# use year as the independent variable separated by different genre create a histogram
histogram1 <- ggplot(dat, aes(year,fill=genre))+geom_histogram()+ 
  # Set histogram parameters
  guides(fill = FALSE) +
  theme_economist() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))
histogram1
```

Figure 1 is a bar chart which illustrates the number of different kinds of films published in different years from 1890 to 2005. According to the trend in the bar chart, it can be seen that with each passing year, the number of the sum of all kinds of films getting released also increased. Short films and proportion of drama films can be seen ton have a gradually increasing trend. The number of documentary films also begun to increase in recent years, but the proportion it shares with other genre is still not high. Action films and comedy films have always dominated, while animated films, after their golden age from 1930 to 1956, now account for a relatively small proportion. The number of romantic films being released are always in acute numbers.

```{r histogram21, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:histogramyLength} Length histogram",out.heighth='75%',out.width='75%',fig.pos = 'H'}
# use length as the independent variable separated by different genre create a histogram
histogram21 <- ggplot(dat, aes(length,fill=genre))+geom_histogram()+
  # Set histogram parameters
  guides(fill = FALSE) +
  theme_economist() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))
histogram21
```

Because the data has many outliers(which is much larger) in the length variable, so we use a log transformation of this variable and then draw a histograms with the log(length).

```{r histogram22, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:histogramyLength} log(Length) histogram",out.heighth='75%',out.width='75%',fig.pos = 'H'}
# redo the forward operation after standardize the variable length
histogram22 <- ggplot(dat, aes(log(length),fill=genre))+geom_histogram()+
  guides(fill = FALSE) +
  theme_economist() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))
histogram22
```

After comparing  Figure 2 using data without transforming into log and the Figure  using data with log transformation, We can see the later one is better. We find that Figure 3 describes the number of different genres of films related to the length. According to the bar chart, the log(length) of a large number of films are located between 4 and 5(about 55.5 to 151.6 minutes). Almost all Short films and Animation films are under 55.5 minutes while Action films are mostly above 55.5 minutes. In addition, Drama and Comedies have different length interval.

```{r histogram3, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:histogrambudeget} Budget histogram",out.heighth='75%',out.width='75%',fig.pos = 'H'}
# use budget as the independent variable separated by different genre create a histogram
histogram3 <- ggplot(dat, aes(budget,fill=genre))+geom_histogram()+
  # Set histogram parameters
  guides(fill = FALSE) +
  theme_economist() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))
histogram3
```

Figure 4 is the relationship between budget and the number of different kinds of films. It's not difficult to see that this is a bell shape histogram. The film, whichever genres it belongs to, the count rises first and then falls and reachs peak at about 12 million dollars.

```{r histogram41, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:histogramVotes} Votes histogram",out.heighth='120%',out.width='75%',fig.pos = 'H'}
# use votes as the independent variable separated by different genre create a histogram
histogram41 <- ggplot(dat, aes(votes,fill=genre))+geom_histogram()+
  # Set histogram parameters
  guides(fill = FALSE) +
  theme_economist() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))
histogram41
```

Because most of the data is located near zero and has many outliers(which is much larger) in the votes variables, we log transform this variable and then draw a histograms with the log(votes).

```{r histogram42, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:histogramVotes} log(Votes) histogram",out.heighth='120%',out.width='75%',fig.pos = 'H'}
# redo the forward operation after standardize the variable votes
histogram42 <- ggplot(dat, aes(log(votes),fill=genre))+geom_histogram()+
  guides(fill = FALSE) +
  theme_economist() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(size =10,face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))
histogram42
```

Comparing Figure 5 using data without log transformation and Figure 6 using the data with log transform, We see the later one is better. Figure 6 is the relationship between votes and the number of different kinds of films. As we can see, small number of films receive a  positive evaluation from the audience, while most of the movies receive low or moderate positive votes.




## Characteristic Comparative Analysis of Films with Different Rating {#sec:Char}

```{r pie1, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig: piegenre} genre pie chat(greater than 7) ",out.heighth='75%',out.width='75%',fig.pos = 'H'}
# Barplot
mytable <- xtabs(~genre+scorename,data=dat)
table <- data.frame(mytable)

table <- data.frame(table)
#$labelPosition<-table$Freq
#table$label<-paste0(table$category,"\n value: ",table$Freq*100,"%")

table%>%
  filter(scorename=="greater than 7") -> tablenew1

label_value <- paste('(', round(tablenew1$Freq/sum(tablenew1$Freq) * 100, 2), '%)', sep = '')
label <- paste(tablenew1$genre, label_value, sep = '')

p <- ggplot(data = tablenew1, mapping = aes(x = 'Content', y = Freq, fill = genre)) +
  geom_bar(stat = 'identity', position = 'stack', width = 1)
p + coord_polar(theta = 'y') + labs(x = '', y = '', title = '') +
  theme_pander()+
  theme(axis.text = element_blank()) + 
  theme(axis.ticks = element_blank()) + 
  scale_fill_discrete(labels = label)
```

Figure 7 is a pie plot which shows the proportion of films of different genre that gets rated higher than 7. We can see that Comedy, Documentary and Animation are the top 3 genres of films which account for 43.54%, 15.5% and 12.73% respectively.

```{r pie2, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig: piegenre} genre pie chat(lower than 7) ",out.heighth='75%',out.width='75%',fig.pos = 'H'}
# Barplot
mytable <- xtabs(~genre+scorename,data=dat)
table <- data.frame(mytable)

table <- data.frame(table)
#$labelPosition<-table$Freq
#table$label<-paste0(table$category,"\n value: ",table$Freq*100,"%")

table%>%
  filter(scorename=="lower than 7") -> tablenew2

label_value <- paste('(', round(tablenew2$Freq/sum(tablenew2$Freq) * 100, 2), '%)', sep = '')
label <- paste(tablenew2$genre, label_value, sep = '')

p <- ggplot(data = tablenew2, mapping = aes(x = 'Content', y = Freq, fill = genre)) +
  geom_bar(stat = 'identity', position = 'stack', width = 1)
p + coord_polar(theta = 'y') + labs(x = '', y = '', title = '') + 
  theme_pander()+
  theme(axis.text = element_blank()) + 
  theme(axis.ticks = element_blank()) +
  scale_fill_discrete(labels = label)
```

Figure 8 is a pie plot which shows the proportion of different genre of films that gets rated lower than 7. According to the plot we can see that the Drama and Action almost account for 80.52%.

```{r boxplot1, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:boxplotyear} Year boxplot",out.heighth='75%',out.width='75%',fig.pos = 'H'}
#boxplot of year
boxplot1 <- ggplot(dat)+geom_boxplot(aes(x=scorename, y=year, fill= genre))+
  guides(fill = FALSE) +
  theme_wsj() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))+
 labs(x="Score", y="Year")
boxplot1
```

Figure 9 is a box plot shows the distribution of different kinds genres which have scores lower and greater than 7 in different years. According to the plot we can see something special, almost all genres of films have a similar distribution irrespective of ratings(lower than 7 or upper than 7) except for Animation and short. It can be easily interpreted that in early years Animated films had higher rating. While after 1980, the ratings of Animated films reduced, large number of films are seen to get rated lower than 7. In addition, It can be seen that very few short films before 1950 got rated lower(Excluding the outliers) which mean Short films are easy to get rated higher on IMDB.

```{r boxplot21, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:boxplotlength} Length boxplot",out.heighth='75%',out.width='75%',fig.pos = 'H'}
#boxplot of length
boxplot21 <- ggplot(dat)+geom_boxplot(aes(x=scorename, y=length, fill= genre))+
    guides(fill = FALSE) +
  theme_wsj() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))+
 labs(x="Score", y="log(Length)")
boxplot21
```
Because the data  has many outliers in the length variable, so we log transform this variable and then draw boxplots with the log(length).

```{r boxplot22, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:boxplotlength} log(Length) boxplot",out.heighth='75%',out.width='75%',fig.pos = 'H'}
boxplot22 <- ggplot(dat)+geom_boxplot(aes(x=scorename, y=log(length), fill= genre))+
    guides(fill = FALSE) +
  theme_wsj() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))+
 labs(x="Score", y="log(Length)")
boxplot22
```

So after comparing the Figure 10 (without transforming into log) and the Figure 11 (using data with transformation), We see the later gives better visual representation. Figure 11 shows the distribution of different kinds of films which have scores lower and upper than 7 of different length. We can easily get the information that the shorter the Drama, Romance and Short films are, higher are the chances for movie of these geners to get rated greater than 7.

```{r boxplot3, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:boxplotbudget} Budget boxplot",out.heighth='75%',out.width='75%',fig.pos = 'H'}
#boxplot of budget
boxplot3 <- ggplot(dat)+geom_boxplot(aes(x=scorename, y=budget, fill= genre))+
    guides(fill = FALSE) +
  theme_wsj() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))+
 labs(x="Score", y="Budget")
boxplot3
```

From figure 12, we can clearly see that on an average, films with higher budget tend to get rated greater than 7. It is reasonable that a guest appearance of a well-known actor, cost of special effects production, magnificent sets are all in the budget. And these elements can all add up to an increased budget and influence to the rating.

```{r boxplot41, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:boxplotvotes} Votes boxplot",out.heighth='75%',out.width='75%',fig.pos = 'H'}
#boxplot of votes
boxplot41 <- ggplot(dat)+geom_boxplot(aes(x=scorename, y=votes, fill= genre))+
    guides(fill = FALSE) +
  theme_wsj() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))+
 labs(x="Score", y="log(Votes)")
boxplot41
```
Since the votes data has too many outliers, we log transform this variable and then draw a plot of boxplots with the log(votes) on vertical axis.

```{r boxplot42, echo = FALSE, eval = TRUE,fig.align = "center", fig.cap = "\\label{fig:boxplotvotes} log(Votes) boxplot",out.heighth='75%',out.width='75%',fig.pos = 'H'}
boxplot42 <- ggplot(dat)+geom_boxplot(aes(x=scorename, y=log(votes), fill= genre))+
    guides(fill = FALSE) +
  theme_wsj() +
  scale_fill_gdocs()+
  guides(fill=guide_legend())+ 
  theme(plot.title = element_text(size = 10,hjust = 0.5, face = "bold"),
        text = element_text(size = 10,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size =10,face ="bold"))+
 labs(x="Score", y="log(Votes)")
boxplot42
```

Figure 13 and Figure 14 are boxplots of different genre plotted against votes, the later one is log transformed. Figure 14 shows the distribution of different genres of films which have scores lower and greater than 7 plotted against log(votes). From the plot we can see that on an average, films get similar amount of positive votes irrespective of the ratings. Almost all the genre have similar distribution and even when the films are grouped by ratings.

In above figures, we can see some similar phenomenons. Firstly, in all four plots, we see many outliers which may be because the variable score is a very subjective. This means no matter how good a movie is, there will always be people who dislike it. Secondly, lower-than-7 Short film's distribution is always a "line" when boxplots are seen, which means there are very few short films which got rated lower than 7. Finally, we cannot see any obvious relationship between the four variables (year, length, budget and votes) and the score through the boxplots, so the following exploration is necessary.

## Correlation Analysis Between Independent Variables {#sec:Cor}
According to previous studies(histograms and boxplots), we find that it is necessary to change votes and length into log(votes) and log(length) to reduce the effect of outliers. So we use the log(votes) and log(length) in the correlation analysis.

```{r scatter1, echo = FALSE, eval = TRUE, fig.align = "center", out.width = '70%',fig.cap = "\\label{fig:point8} The relationship of factors related to independent variables",fig.pos = "H"}
Num.cols <- cbind(dat[,2],log(dat[,3]),dat[,4],log(dat[,5]))
colnames(Num.cols ) <- c("year","log(length)","budget","log(votes)")
Cor.data <- cor(Num.cols)
par(mfrow = c(1,2))
corrplot(Cor.data, method = 'color')
corrplot(Cor.data, method = "number")
```



```{r corr_matrix, echo = FALSE, eval = TRUE, fig.align = "center", out.width = '70%',fig.cap = "\\label{fig:point00} Correlation matrix of data",fig.pos = "H"}
### correlation matrix using ggpairs
ggpairs(Num.cols ,
        upper = list(continuous = "cor", combo = "box_no_facet", discrete = "count", na ="na"),
        lower = list(continuous = "points", combo = "facethist", discrete = "facetbar", na ="na"),
        diag = list(continuous = "densityDiag", discrete = "barDiag", na = "naDiag"),
  params = NULL)+
  theme_test()+
  theme(plot.title = element_text(size = 8,hjust = 0.5, face = "bold"),
        text = element_text(size = 8,face = "bold",hjust = 0.5),
        axis.title.y = element_text(face = "bold",hjust = 0.5),
        axis.text.x = element_text(size = 8,face ="bold"))
```

Figure 15 and Figure 16 are the correlation matrix between the variables (year, length, budget and votes). According to the correlation matrix, we can see that these variables are not much related to each other which means we should not be worried about the multicollinearity problem in the following data analysis.

\newpage
# Formal Data Analysis {#sec:FDA}
## The Construction of GLM Model {#sec:GLM}
From the previous studies(histogram and boxplot), we find that it is necessary to change votes and length into log(votes) and log(length) to reduce the effect of outliers. So we use the log(votes) and log(length) in the Formal Data Analysis analysis.

```{r score_class, echo = FALSE, eval = FALSE}
### change the class of score from numeric to factor
dat$score<-as.factor(dat$score)
```
For the pre-processing of the data, the rating variable is converted to a binary variable:
$\mathbb{I}_{\mbox{score}}(i)$ is an indicator function such that

$${\mbox{score}}(i)=\left\{
\begin{array}{ll}
1 ~~~ \mbox{if score of observations is greater than 7},\\
0 ~~~ \mbox{if score of observations is lower than 7}.\\
\end{array}
\right.$$

we can use a logistic regression model for the probability of success(movie getting rated greater than7). We first write it down in mathematical notation by letting ${\mbox{p}}_{\mbox{i}} = {\mbox{P}}({\mbox{Y}}_{\mbox{i}}=1)$ denotes the probability of success for the film. We assume that the ${\mbox{Y}}_{\mbox{i}}$ are independent random variables which follow the Bin$(1,{\mbox{p}}_{\mbox{i}} )$(or Bernoulli $({\mbox{p}}_{\mbox{i}})$ distribution. The full GLM can be written as 

$$log[({\mbox{p}}_{\mbox{ij}})/ (1-{\mbox{p}}_{\mbox{ij}})]= \widehat{\alpha} +
\widehat{\beta}_{\mbox{1}} \cdot \mbox{year}_{\mbox{j}} +
 \widehat{\beta}_{\mbox{2}} \cdot {\mbox{log(length)}}_{\mbox{j}} +
\widehat{\beta}_{\mbox{3}} \cdot {\mbox{budget}}_{\mbox{j}} +
 \widehat{\beta}_{\mbox{4}} \cdot {\mbox{log(votes)}}_{\mbox{j}}+
\widehat{\beta}_{\mbox{5}} \cdot \mathbb{I}_{\mbox{genre}}(i)+ 
 \epsilon_i, ~~~~ \epsilon_i \sim N(0, \sigma^2)$$

where

${\mbox{p}}_{\mbox{ij}}$ is the probability of the $j \mbox{th}$th films score is greater than 7 in the $i \mbox{th}$ genre;

the intercept ${\alpha}$ is the mean score for the baseline category of Action genre

$t{\beta}_{\mbox{1-4}}$ is the value of score that changes as the corresponding independent variable changes by one unit;

${\beta}_{\mbox{5}}$ is the difference in the mean score of 6 other genres; 

${\mbox{variables}}_{\mbox{j}}$ is the $j \mbox{th}$ observations of the continuous variables;

and

$\mathbb{I}_{\mbox{genre}}(i)$ is an indicator function such that

$$\mathbb{I}_{\mbox{genre}}(i)=\left\{
\begin{array}{ll}
1 ~~~ \mbox{if genre of} ~ j \mbox{th observations belongs to the }{\mbox{genre}}(i),\\
0 ~~~ \mbox{if genre of} ~ j \mbox{th observations belongs to the genre other than }{\mbox{genre}}(i).\\
\end{array}
\right.$$



Here is the result of the model 
```{r first_model, echo = FALSE, eval = TRUE}
#fit a glm model
model1 <- glm(score ~ year+log(length)+budget+log(votes)+genre, data = dat, 
             family = binomial(link = "logit"))
model1_list <- summ(model1)
model1_list[1] %>%
kable(caption = '\\label{tab:reg} Estimates of the parameters from the fitted GLM
regression model1.') %>%
kable_styling(latex_options = 'HOLD_position') 
```


According to the p-value, we can see two variables are not or partly not significant. First is year(p-value of 	0.2749860) , second is log(votes)(p-value of 0.9373484) and last is genre(p-value of genreRomance is 0.2265949).

## The Selection of GLM Model by Stepwise Regression Approach  {#sec:Sele}

We use the method of stepwise regression to choose the best model which contains all the significant independent variables and has the lowest AIC score,

```{r step, echo = FALSE, eval = TRUE}
#use stepwise find the lowest AIC model
logit.step <- step(model1,direction="both")
summary(logit.step)
```

The AIC of model3(with independent variables log(length), budget and genre) is 1542.3 and according to the stepwise regression, we know this model is the best one with a lowest AIC. So we choose this model.

## Analysis of The Optimal GLM Model{#sec:Sel}
we finally analyse the results from the Optimal GLM Model.

$$log[({\mbox{p}}_{\mbox{ij}})/ (1-{\mbox{p}}_{\mbox{ij}})]= \widehat{\alpha} +
 \widehat{\beta}_{\mbox{1}} \cdot {\mbox{log(length)}}_{\mbox{i}} +
 \widehat{\beta}_{\mbox{2}} \cdot {\mbox{budget}}_{\mbox{i}} +
 \widehat{\beta}_{\mbox{3}} \cdot \mathbb{I}_{\mbox{genre}}(i)+ 
 \epsilon_i, ~~~~ \epsilon_i \sim N(0, \sigma^2)$$

```{r Optimal, echo = FALSE, eval = TRUE}
#fit a final glm model
model2 <- glm(score ~ log(length)+budget+genre, data = dat, 
             family = binomial(link = "logit"))
model2_list <- summ(model2)
model2_list[1] %>%
kable(caption = '\\label{tab:reg} Estimates of the parameters from The Optimal GLM Model.',align = c("c", "c", "c")) %>%
kable_styling(latex_options = 'HOLD_position') 


odd_ratio<-exp(coef(model2)) ###########Odd ratio 
bb<-exp(confint(model2))#####odd ratio 95% CI 
combine<-cbind(odd_ratio,bb)
combine%>%
kable(caption = '\\label{tab:reg} Estimates of Odds In 95percentage confidence Interval.',align = c("c", "c", "c")) %>%
kable_styling(latex_options = 'HOLD_position')
```
We see from the output that the coefficient for length is negative, indicating a lower score for films with longer length. Similarly the coefficients for  genreAnimation, genreDrama and genreRomance are negative.

To quantify the effect of each of these predictors, we look at odds ratios which can be computed as $exp(\widehat{\beta})$. These are shown in the plot below.


```{r optimal plot1, echo = FALSE, eval = TRUE, fig.align = "center", out.width = '70%',fig.cap = "\\label{fig:line plot} Odds Ratios Plot",fig.pos = "H"}
p <- plot_model(model2, show.values=TRUE,show.p = TRUE, value.offset = .3)+
  theme_sjplot()
p
```
We interpret the odds ratios as follows: 

1. For each minute increase in the log(length) of film, the odds of film getting rated greater than 7 decrease (get multiplied by a factor of 0.05);

2. For each $1000000 increase in the budget of film, the odds of film getting rated greater than 7 increase (get multiplied by a factor of 1.71);

3. Animation's odds of score is 0.07 times those of Action; Comedy's odds of score is 24.64 times those of Action; Documentary's odds of score is 174.89 times those of Action; Drama's odds of score is 0.17 times those of Action; Short's odds of score is 79.59 times those of Action; Romance's odds of score is same as those of Action(not significant).

```{r optimal plot2, echo = FALSE, eval = TRUE, fig.align = "center", out.width = '70%',fig.cap = "\\label{fig:line plot}Predicted Probabilities Of Film Score Plot",fig.pos = "H"}
plot_model(model2,type="pred",terms="length[all]")+theme_sjplot()
plot_model(model2,type="pred",terms="budget[all]")+theme_sjplot()
plot_model(model2,type="pred",terms="genre")+theme_sjplot()
```

## Analysis of assessing the predictive power {#sec:ROC}

```{r optimal plotpredit, echo = FALSE, eval = TRUE, fig.align = "center", out.width = '70%',fig.cap = "\\label{fig:line plot}Predicted Probabilities Of Film Score Plot",fig.pos = "H"}
model2$score_predit <- predict(model2, dat, type="response")
predit <- prediction(model2$score_predit, dat$score)
perf <- performance(predit,"tpr","fpr")
auc <- performance(predit,"auc")
perfd <- data.frame(x= perf@x.values[1][[1]], y=perf@y.values[1][[1]])
pp<- ggplot(perfd, aes(x= x, y=y)) + 
  geom_line() +
  theme_sjplot()+ 
  xlab("False positive rate") + 
  ylab("True positive rate") +
ggtitle(paste("Area under the curve:", round(auc@y.values[[1]], 3)))
pp
```
On the horizontal axis of the ROC curve we have the false positive rate and on the vertical axis the true positive rate. The area under the ROC curve, known as AUC, is used as a measure of a diagnostic test’s discriminatory power. The area under the curve is about 0.958. So the model2 performs better than a random guess and the model2 which we choose has a good predictive power.

\newpage
# Conclusions {#sec:Conc}
IMDB ratings can be considered as a criterion to judge a movie by it's entertainment value. Thus, IMDB ratings might influence the viewer's decision to watch a film or not. Therefore, factors influencing the IMDB ratings may be of atmost priority to film producers.

From the analysis, It can be concluded that factors like length of the movie, budget of the movie and genre can highly influence IMDB ratings and can determine which movie might get rated above 7 or less. 

Growing time constraints may be a significat reason as to why length of a film may affect its IMDB rating. Audience, nowadays, prefer watching a movie with high entertainment value which gets over within a brief period. Hence, shorter the runtime of a movie, the more likely it is for a movie to get rated greater than 7.

The majesticity of a movie can play a huge role in affecting the ratings of a movie, A visually appealing movie has a higher chance of getting rated more than 7 on IMDB. These visual effects and technicalities may lead to an increasing budget of the movies, consequently making budget as an important predictor of IMDB ratings greater than 7 or less.

People tend to favour watching a movie of a particular genre than other, though it a highly subjective choice. The analysis show that films of some genres perform well in getting rated above 7 on IMDB than others. It can be concluded from the analysis that a Comedy film, documentary style film or a short film have better odds of getting rated above 7 on IMDB compared to a action film. Hence, genre of a film may also be helpful in predicting whether or not a movie will be rated above 7 on IMDB ratings or not.

# Future work {#sec:Fut}

The dataset observed of the analysis is just a subset of IMDB movie database, and in our model we supressed outliers. In this paper, the rating level of 7 is considered as the standard of judging a film(good or bad). The analysis of plethora of movies, multiple databases can be done to reduce prediction errors of IMDB ratings in the future. This paper mainly uses a generalized linear model to analyze the data, and future work may involves deeper analysis of films and genre. In the future work, we can mainly focus on the following points:

1. Add rating weights for films from different decades to the model. Because different eras have different cultural interests, a film that is rated less than 7 in one decade could be rated higher than 7 if released in another decade.

2. The dataset chosen for the analysis is just a subset of IMDB films database. In future, we can try to study the complete database and several other movie databases at the same time and compare and analyze them, so as to provide a comprehensive result and determine all the factors that might affect the IMDB ratings 

3. The way to build the model can be changed to more complex logistic regression which might give a better prediction with low error rates.

In the analysis of films getting rated greater than 7, this paper finds that comedies account for 43.54 percent which is a large a number, so it needs to be backed with several other analysis of different genre of film in order to convince the targeted audience. Also, for films of different eras, outliers mostly appeared before 1950. Whether the rating of that era is valid needs to be explored, because 70 years have passed, and cultural and social differences might affect the rating level. So we should do a weighted analysis of films from different eras.In addition, average budget required for different types of films is not consistent. For example, an action blockbuster requires a large budget for setting special effects, and action sequences, while a comedy usually doesn't. So the budget distribution Cannot be generalised.

# Reference {#sec:REF}

1.Balabantaray S R. Impact of Indian cinema on culture and creation of world view among youth: A sociological analysis of Bollywood movies[J]. Journal of Public Affairs, 2014: e2405.

2.Homan R L. The Everyman movie, circa 1991[J]. Journal of Popular Film and Television, 1997, 25(1): 21-30.

3.Jackson T, Marks N. Consumption, sustainable welfare and human needs—with reference to UK expenditure patterns between 1954 and 1994[J]. Ecological economics, 1999, 28(3): 421-441.

4.Kubrak T. Impact of Films: Changes in Young People’s Attitudes after Watching a Movie[J]. Behavioral Sciences, 2020, 10(5): 86.

5.Peralta V. Extraction and integration of movielens and imdb data[J]. Laboratoire Prisme, Université de Versailles, Versailles, France, 2007.
